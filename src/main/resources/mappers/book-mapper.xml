<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.nextit.ditto.book.BookMapper">
    <select id="getBookListCount" resultType="int" parameterType="searchVO">
        SELECT
            COUNT(*) CNT
        FROM
            BOOK

      <!--  WHERE
            <if test="searchWord 비어있지 않을 떄">
                <if test='searchType == "title"'>
                    A.BOOK_NAME LIKE '%' || #{searchWord} || '%'
                </if>
                <if test='searchType == "content"'>
                    A.BOOK_AUTHOR LIKE '%' || #{searchWord} || '%'
                </if>
            </if>-->

        <where>
            <if test='searchType == "bookName"'>
                A.BOOK_NAME LIKE '%' || #{searchWord} || '%'
            </if>
            <if test='searchType == "bookAuthor"'>
                A.BOOK_AUTHOR LIKE '%' || #{searchWord} || '%'
            </if>
        </where>
    </select>

    <select id="selectBooks" parameterType="searchVO"  resultType="bookVO">
    SELECT *
    FROM
        (
            SELECT
                    *
            FROM
        (
            SELECT
                    A.BOOK_NO,
                    A.BOOK_NAME,
                    A.BOOK_COMPANY,
                    A.BOOK_INTRO,
                    A.BOOK_RENT,
                    A.BOOK_AUTHOR,
                    A.BOOK_RELEASE,
                    A.BOOK_IMAGE
            FROM
                    book A
        )
            B
        <where>
            <if test="searchType == 'bookName'">
                BOOK_NAME LIKE '%' || #{searchWord} || '%'
            </if>
            <if test="searchType == 'bookAuthor'">
                BOOK_AUTHOR LIKE '%' || #{searchWord} || '%'
            </if>
        </where>

    ) C
        WHERE C.BOOK_NO BETWEEN #{firstRecordIndex} AND #{lastRecordIndex}
<!--        LIMIT #{firstRecordIndex}, 10-->
<!--        LIMIT 로 하면 가장 첫번째 도서가 누락됩니다. . . -->
    </select>


<!--  getBook 도서 정보 상세보기 쿼리문   -->
    <select id="getBook" parameterType="int" resultType="bookVO">
        SELECT *
        FROM
            book
        WHERE
            BOOK_NO = #{bookNo}
    </select>
</mapper>